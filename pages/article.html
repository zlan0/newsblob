<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Article | GhanaFront</title>
  <meta name="description" content="">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&family=Geist+Mono:wght@400;500&family=Playfair+Display:ital,wght@0,700;0,800;1,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>

<div id="headerRoot"></div>
<div id="tickerRoot"></div>
<div id="articleRoot"></div>
<div id="chatRoot"></div>

<script>
  try {
    var cfg = JSON.parse(localStorage.getItem('gf_site_config') || '{}');
    window.API_BASE = cfg.apiBase || 'https://ghanaever-new.onrender.com';
  } catch(e) {
    window.API_BASE = 'https://ghanaever-new.onrender.com';
  }
</script>
<script src="../js/app.js"></script>
<script>
  // Override paths for subpage
  const _buildHeader = buildHeader;

  document.addEventListener('DOMContentLoaded', async () => {
    // Patch header links for pages/ subdirectory
    document.getElementById('headerRoot').innerHTML = buildHeader();
    // Fix logo href for subpage
    document.querySelector('.logo').href = '../index.html';
    document.querySelectorAll('.nav-link').forEach(a => {
      const href = a.getAttribute('href');
      if (href && !href.startsWith('..')) {
        a.href = href.replace('pages/', '');
      }
    });

    document.getElementById('tickerRoot').innerHTML = buildTicker(MOCK_TRENDING.slice(0,5));
    document.getElementById('chatRoot').innerHTML = buildChatbot();
    applyDark();
    initSearch();
    initChat();

    // Get article id from URL
    const params = new URLSearchParams(location.search);
    const id = params.get('id');

    // Try API first
    let article = null;
    if (id) {
      const data = await apiFetch(`/api/articles/${id}`);
      article = data || MOCK_ARTICLES.find(a => a.id === id);
    }
    if (!article) article = MOCK_ARTICLES[0];

    // Update page title + meta
    document.title = `${article.title} | GhanaFront`;
    document.querySelector('meta[name="description"]').content = article.summary || '';

    // Inject JSON-LD
    const ld = document.createElement('script');
    ld.type = 'application/ld+json';
    ld.textContent = JSON.stringify({
      "@context": "https://schema.org",
      "@type": "NewsArticle",
      "headline": article.title,
      "description": article.summary,
      "datePublished": article.published_at,
      "author": { "@type": "Organization", "name": article.source },
      "publisher": { "@type": "Organization", "name": "GhanaFront", "url": "https://ghanafront.com" }
    });
    document.head.appendChild(ld);

    renderArticle(article);
  });

  function renderArticle(article) {
    const cat       = article.category || 'general';
    const bg        = CAT_BG[cat]     || CAT_BG.general;
    const st        = CAT_STROKE[cat] || CAT_STROKE.general;
    const breaking  = isBreaking(article.published_at);
    const pageUrl   = location.href;

    document.getElementById('articleRoot').innerHTML = `
    <div class="article-detail">

      <!-- Back -->
      <a href="../index.html" style="display:inline-flex;align-items:center;gap:6px;font-size:13px;color:var(--muted);margin-bottom:24px;transition:color .12s"
         onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="15 18 9 12 15 6"/></svg>
        Back to feed
      </a>

      <!-- Tags -->
      <div style="display:flex;align-items:center;gap:6px;margin-bottom:16px">
        ${breaking ? `<span class="tag tag-breaking"><div class="ticker-blink"></div>Breaking</span>` : ''}
        <span class="tag tag-${cat}">${cat}</span>
      </div>

      <!-- Headline -->
      <h1>${article.title}</h1>

      <!-- Byline -->
      <div class="byline">
        <div class="src-dot" style="color:white">${ICONS.srcDot}</div>
        <div>
          <div class="src-name">${article.source}</div>
          <div class="src-time">${timeAgo(article.published_at)}</div>
        </div>
        ${article.views ? `
        <div class="stat-pill" style="margin-left:auto">
          ${ICONS.eye} ${fmtViews(article.views)} views
        </div>` : ''}
      </div>

      <!-- Hero image -->
      ${article.image_url
        ? `<img class="hero-img" src="${article.image_url}" alt="${article.title}">`
        : `<div style="height:320px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:${bg};margin-bottom:28px">
             <svg width="72" height="72" viewBox="0 0 24 24" fill="none" stroke="${st}" stroke-width="0.7" stroke-linecap="round">
               <rect x="3" y="3" width="18" height="18" rx="2"/>
               <circle cx="8.5" cy="8.5" r="1.5"/>
               <polyline points="21 15 16 10 5 21"/>
             </svg>
           </div>`}

      <!-- Summary -->
      <p class="summary">${article.summary || ''}</p>

      <!-- Share buttons -->
      <div class="share-row">
        <a class="share-platform share-twitter" href="https://twitter.com/intent/tweet?text=${encodeURIComponent(article.title)}&url=${encodeURIComponent(pageUrl)}" target="_blank" rel="noopener">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-4.714-6.231-5.401 6.231H2.74l7.73-8.835L1.254 2.25H8.08l4.258 5.63 5.907-5.63Zm-1.161 17.52h1.833L7.084 4.126H5.117Z"/></svg>
          Twitter
        </a>
        <a class="share-platform share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(pageUrl)}" target="_blank" rel="noopener">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
          Facebook
        </a>
        <a class="share-platform share-whatsapp" href="https://wa.me/?text=${encodeURIComponent(article.title + ' ' + pageUrl)}" target="_blank" rel="noopener">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
          WhatsApp
        </a>
        <button class="share-platform" onclick="copyLink('${pageUrl}')">
          ${ICONS.share}
          Copy link
        </button>
      </div>

      <!-- CTA -->
      <a href="${article.url || '#'}" target="_blank" rel="noopener" class="cta">
        Read full article at ${article.source}
        ${ICONS.externalLink}
      </a>

      <!-- Related articles -->
      <div style="margin-top:48px">
        <div class="section-head" style="margin-bottom:16px">
          <div class="section-label2">
            <div class="section-rule"></div>Related Stories
          </div>
        </div>
        <div class="article-grid" style="grid-template-columns:repeat(3,1fr)">
          ${MOCK_ARTICLES.filter(a => a.id !== article.id).slice(0,3).map((a,i) => buildCard(a,i)).join('')}
        </div>
      </div>

    </div>`;
  }

  function copyLink(url) {
    navigator.clipboard.writeText(url);
    // Brief feedback
    event.target.closest('button').innerHTML = `${ICONS.check} Copied!`;
    setTimeout(() => { event.target.closest('button').innerHTML = `${ICONS.share} Copy link`; }, 1500);
  }
</script>
</body>
</html>