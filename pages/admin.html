<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel â€” GhanaFront</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&family=Geist+Mono:wght@400;500&family=Playfair+Display:ital,wght@0,700;0,800;1,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/admin.css">
</head>
<body class="admin-body">

<!-- Login Gate -->
<div id="loginGate" class="login-gate">
  <div class="login-card">
    <div class="login-logo">
      <div class="logo-mark" style="width:40px;height:40px;border-radius:8px;position:relative;overflow:hidden;margin:0 auto 12px">
        <div class="logo-mark-bg"></div>
        <div class="logo-mark-letter" style="position:relative;z-index:1;display:flex;align-items:center;justify-content:center;height:100%;font-family:'Playfair Display',serif;font-weight:800;font-size:22px;color:#fff">G</div>
      </div>
      <h1 class="login-title">GhanaFront Admin</h1>
      <p class="login-subtitle">Sign in to manage your site</p>
    </div>
    <form onsubmit="adminLogin(event)">
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="loginEmail" placeholder="admin@ghanafront.com" value="admin@ghanafront.com">
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" class="form-input" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" value="admin123">
      </div>
      <div id="loginError" class="login-error" style="display:none">Incorrect email or password</div>
      <button type="submit" class="form-btn form-btn-ad" style="width:100%;margin-top:8px">Sign In</button>
    </form>
    <p style="font-size:11px;color:var(--subtle);text-align:center;margin-top:14px">Default: admin@ghanafront.com / admin123</p>
  </div>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="admin-panel" style="display:none">
  <!-- Sidebar -->
  <aside class="admin-sidebar">
    <div class="admin-brand">
      <div class="logo-mark" style="width:28px;height:28px;border-radius:5px;position:relative;overflow:hidden;flex-shrink:0">
        <div class="logo-mark-bg"></div>
        <div class="logo-mark-letter" style="position:relative;z-index:1;display:flex;align-items:center;justify-content:center;height:100%;font-family:'Playfair Display',serif;font-weight:800;font-size:15px;color:#fff">G</div>
      </div>
      <div>
        <div style="font-weight:700;font-size:13px;line-height:1.2" id="adminSiteName">GhanaFront</div>
        <div style="font-size:10px;color:var(--subtle)">Admin Panel</div>
      </div>
    </div>
    <nav class="admin-nav">
      <button class="admin-nav-item active" data-tab="scraped" onclick="switchTab('scraped',this)">
        <span class="admin-nav-icon" id="iconScraped"></span>
        ğŸ“° Scraped Articles
        <span id="pendingBadge" class="admin-badge" style="background:#ce1126;color:#fff;border-radius:9px;padding:1px 6px;font-size:10px;font-weight:700;margin-left:auto"></span>
      </button>
      <button class="admin-nav-item" data-tab="post" onclick="switchTab('post',this)">
        <span class="admin-nav-icon" id="iconPost"></span>
        âœï¸ Post Article
      </button>
      <button class="admin-nav-item" data-tab="scraper" onclick="switchTab('scraper',this)">
        <span class="admin-nav-icon" id="iconRss"></span>
        âš™ï¸ Scraper Config
      </button>
      <button class="admin-nav-item" data-tab="ticker" onclick="switchTab('ticker',this)">
        <span class="admin-nav-icon" id="iconTicker"></span>
        Ticker
      </button>
      <button class="admin-nav-item" data-tab="breaking" onclick="switchTab('breaking',this)">
        <span class="admin-nav-icon" id="iconBreaking"></span>
        Breaking News
      </button>
      <button class="admin-nav-item" data-tab="trending" onclick="switchTab('trending',this)">
        <span class="admin-nav-icon" id="iconTrending"></span>
        Trending News
      </button>
      <button class="admin-nav-item" data-tab="appearance" onclick="switchTab('appearance',this)">
        <span class="admin-nav-icon" id="iconAppearance"></span>
        Appearance
      </button>
      <button class="admin-nav-item" data-tab="popups" onclick="switchTab('popups',this)">
        <span class="admin-nav-icon" id="iconPopups"></span>
        Popup Settings
      </button>
      <button class="admin-nav-item" data-tab="menus" onclick="switchTab('menus',this)">
        <span class="admin-nav-icon" id="iconMenus"></span>
        Menu Navigation
      </button>
      <button class="admin-nav-item" data-tab="general" onclick="switchTab('general',this)">
        <span class="admin-nav-icon" id="iconGeneral"></span>
        General Settings
      </button>
      <button class="admin-nav-item" data-tab="backend" onclick="switchTab('backend',this)">
        <span class="admin-nav-icon" id="iconBackend"></span>
        Backend / API
      </button>
    </nav>
    <div class="admin-sidebar-footer">
      <a href="../index.html" class="admin-view-site" target="_blank">â† View Site</a>
      <button class="admin-logout" onclick="adminLogout()">Log Out</button>
    </div>
  </aside>

  <!-- Main -->
  <main class="admin-main">
    <div class="admin-topbar">
      <h2 class="admin-page-title" id="adminPageTitle">Scraper Config</h2>
      <div class="admin-topbar-right">
        <div id="saveStatus" class="save-status"></div>
        <button class="admin-save-btn" onclick="saveAllSettings()" id="saveBtn">
          <span id="saveBtnText">Save Changes</span>
        </button>
      </div>
    </div>

    <!-- â”€â”€ Scraped Articles Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="admin-tab active" id="tab-scraped">
      <div class="admin-card">
        <div class="admin-card-head">
          <h3 class="admin-card-title">Scraped Articles Inbox</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="admin-add-btn" onclick="triggerScrape()" id="scrapeNowBtn">ğŸ”„ Scrape Now</button>
            <button class="admin-add-btn" style="background:#f59e0b" onclick="bulkApprove(false)">âœ… Approve Selected</button>
            <button class="admin-add-btn" style="background:#7c3aed" onclick="bulkApprove(true)">ğŸ¤– AI Rewrite + Approve</button>
          </div>
        </div>
        <p class="admin-card-desc">Scraped articles awaiting review. Approve to publish, or use AI Rewrite to expand to 600â€“900 words of original content for AdSense/Adsterra compliance.</p>
        <div style="display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap;align-items:center">
          <label style="display:flex;align-items:center;gap:6px;font-size:13px">
            <input type="checkbox" id="selectAllPending" onchange="toggleSelectAll(this)"> Select All
          </label>
          <span id="scrapedCount" style="font-size:12px;color:var(--muted)"></span>
          <button class="admin-add-btn" style="background:#dc2626;margin-left:auto" onclick="deleteSelected()">ğŸ—‘ Delete Selected</button>
        </div>
        <div id="scrapedList" style="display:flex;flex-direction:column;gap:10px">
          <div style="padding:20px;text-align:center;color:var(--muted)">Loading scraped articles...</div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Post Article Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="admin-tab" id="tab-post">
      <div class="admin-card">
        <h3 class="admin-card-title">Post News Article</h3>
        <p class="admin-card-desc">Write and publish an original article. Enable "AI Expand" to have AI generate a full 600â€“900 word article for AdSense compliance from your brief outline.</p>
        <div class="form-grid" style="gap:16px">
          <div class="form-group" style="grid-column:1/-1">
            <label class="form-label">Headline / Title <span class="required">*</span></label>
            <input type="text" class="form-input" id="postTitle" placeholder="e.g. Ghana's Economy Grows 7.2% in Q1 2026">
          </div>
          <div class="form-group">
            <label class="form-label">Category</label>
            <select class="form-input" id="postCategory">
              <option value="general">General</option>
              <option value="politics">Politics</option>
              <option value="business">Business</option>
              <option value="sports">Sports</option>
              <option value="tech">Tech</option>
              <option value="health">Health</option>
              <option value="entertainment">Entertainment</option>
              <option value="world">World</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Region</label>
            <select class="form-input" id="postRegion">
              <option value="ghana">Ghana</option>
              <option value="africa">Africa</option>
              <option value="global">Global</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Author / Source</label>
            <input type="text" class="form-input" id="postSource" value="GhanaFront Staff">
          </div>
          <div class="form-group">
            <label class="form-label">Image URL <span class="form-opt">optional</span></label>
            <input type="url" class="form-input" id="postImageUrl" placeholder="https://...">
          </div>
          <div class="form-group" style="grid-column:1/-1">
            <label class="form-label">Article Content <span class="required">*</span></label>
            <textarea class="form-textarea" id="postContent" rows="12" placeholder="Write your article or brief outline here. AI Expand will turn it into a full 600â€“900 word article."></textarea>
            <span class="form-hint" id="contentWordCount">0 words</span>
          </div>
          <div class="form-group" style="grid-column:1/-1">
            <label class="form-label">Summary / Excerpt <span class="form-opt">auto-generated if empty</span></label>
            <textarea class="form-textarea" id="postSummary" rows="2" placeholder="Short description for article cards..."></textarea>
          </div>
        </div>
        <div style="display:flex;gap:16px;margin-top:16px;flex-wrap:wrap;align-items:center">
          <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer">
            <input type="checkbox" id="postAiExpand" checked>
            <span>ğŸ¤– AI Expand to 600-900 words (recommended)</span>
          </label>
          <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer">
            <input type="checkbox" id="postAutoPublish" checked>
            <span>Publish immediately</span>
          </label>
        </div>
        <div style="margin-top:18px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="form-btn form-btn-ad" style="max-width:240px" onclick="submitPostArticle()">
            ğŸ“¤ Publish Article
          </button>
          <button class="form-btn" style="background:var(--surface2);color:var(--text);border:1px solid var(--border);max-width:160px" onclick="clearPostForm()">
            Clear Form
          </button>
        </div>
        <div id="postStatus" style="margin-top:12px;font-size:13px"></div>
      </div>
    </div>

    <!-- â”€â”€ Scraper Config Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="admin-tab" id="tab-scraper">
      <div class="admin-card">
        <div class="admin-card-head">
          <h3 class="admin-card-title">RSS News Sources</h3>
          <button class="admin-add-btn" onclick="addRssSource()">+ Add Source</button>
        </div>
        <p class="admin-card-desc">Configure the RSS feeds that GhanaFront scrapes for news. Active sources are polled every 5 minutes.</p>
        <div id="rssList" class="rss-list"></div>
      </div>
      <div class="admin-card">
        <h3 class="admin-card-title">Scraper Settings</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Scrape Interval (minutes)</label>
            <input type="number" class="form-input" id="scrapeInterval" value="5" min="1" max="60">
          </div>
          <div class="form-group">
            <label class="form-label">Max Articles per Source</label>
            <input type="number" class="form-input" id="maxArticles" value="20" min="5" max="100">
          </div>
          <div class="form-group">
            <label class="form-label">Article Retention (days)</label>
            <input type="number" class="form-input" id="retention" value="30" min="1" max="365">
          </div>
          <div class="form-group">
            <label class="form-label">Default Category for Unknown</label>
            <select class="form-input" id="defaultCategory">
              <option value="general" selected>General</option>
              <option value="politics">Politics</option>
              <option value="business">Business</option>
              <option value="world">World</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Ticker Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="admin-tab" id="tab-ticker">
      <div class="admin-card">
        <h3 class="admin-card-title">Ticker Settings</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Ticker Label</label>
            <input type="text" class="form-input" id="tickerLabel" placeholder="Breaking">
          </div>
          <div class="form-group">
            <label class="form-label">Scroll Speed (seconds â€” lower = faster)</label>
            <input type="number" class="form-input" id="tickerSpeed" min="5" max="120" step="1">
            <span class="form-hint">Range: 5 (very fast) to 120 (slow). Default: 18</span>
          </div>
        </div>
        <div class="form-group" style="margin-top:16px">
          <label class="form-label">Ticker Source</label>
          <div class="radio-group">
            <label class="radio-label"><input type="radio" name="tickerSource" value="breaking" id="tickerSrcBreaking" checked> Use Breaking News list (below)</label>
            <label class="radio-label"><input type="radio" name="tickerSource" value="live"> Use Live API articles</label>
          </div>
        </div>
      </div>
      <div class="admin-card">
        <div class="admin-card-head">
          <h3 class="admin-card-title">Ticker Preview</h3>
        </div>
        <div id="tickerPreview" class="ticker-preview-wrap"></div>
      </div>
    </div>

    <!-- â”€â”€ Breaking News Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="admin-tab" id="tab-breaking">
      <div class="admin-card">
        <div class="admin-card-head">
          <h3 class="admin-card-title">Breaking News Headlines</h3>
          <button class="admin-add-btn" onclick="addBreakingItem()">+ Add Headline</button>
        </div>
        <p class="admin-card-desc">These headlines scroll in the ticker bar. Drag to reorder (drag handle).</p>
        <div id="breakingList" class="sortable-list"></div>
      </div>
    </div>

    <!-- â”€â”€ Trending News Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="admin-tab" id="tab-trending">
      <div class="admin-card">
        <div class="admin-card-head">
          <h3 class="admin-card-title">Trending News Items</h3>
          <button class="admin-add-btn" onclick="addTrendingItem()">+ Add Item</button>
        </div>
        <p class="admin-card-desc">These appear in the "Trending Now" sidebar widget. Drag to reorder.</p>
        <div id="trendingList" class="sortable-list"></div>
      </div>
    </div>

    <!-- â”€â”€ Appearance Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="admin-tab" id="tab-appearance">
      <div class="admin-card">
        <h3 class="admin-card-title">Branding</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Site Name</label>
            <input type="text" class="form-input" id="siteName" placeholder="GhanaFront">
          </div>
          <div class="form-group">
            <label class="form-label">Site Tagline / Meta Description</label>
            <input type="text" class="form-input" id="siteTagline" placeholder="Ghana News Today | Breaking News Accra">
          </div>
          <div class="form-group">
            <label class="form-label">Logo URL <span class="form-opt">leave blank for letter mark</span></label>
            <input type="url" class="form-input" id="logoUrl" placeholder="https://â€¦/logo.png">
          </div>
          <div class="form-group">
            <label class="form-label">Favicon URL <span class="form-opt">leave blank for default</span></label>
            <input type="url" class="form-input" id="faviconUrl" placeholder="https://â€¦/favicon.ico">
          </div>
        </div>
      </div>
      <div class="admin-card">
        <h3 class="admin-card-title">Colors</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Primary / Accent Color</label>
            <div style="display:flex;gap:10px;align-items:center">
              <input type="color" id="primaryColor" style="width:44px;height:36px;border:1px solid var(--border);border-radius:6px;padding:2px;cursor:pointer">
              <input type="text" class="form-input" id="primaryColorHex" placeholder="#ce1126" style="flex:1">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Link / Hover Accent Color</label>
            <div style="display:flex;gap:10px;align-items:center">
              <input type="color" id="accentColor" style="width:44px;height:36px;border:1px solid var(--border);border-radius:6px;padding:2px;cursor:pointer">
              <input type="text" class="form-input" id="accentColorHex" placeholder="#d4993a" style="flex:1">
            </div>
          </div>
        </div>
        <div class="color-preview" id="colorPreview">
          <div class="color-swatch" id="swatch1"></div>
          <div class="color-swatch" id="swatch2"></div>
          <span style="font-size:12px;color:var(--muted)">Color preview</span>
        </div>
      </div>
      <div class="admin-card">
        <h3 class="admin-card-title">Search Bar</h3>
        <div class="form-group">
          <label class="form-label">Search Placeholder Text</label>
          <input type="text" class="form-input" id="searchPlaceholder" placeholder="Search Ghana newsâ€¦">
        </div>
      </div>
    </div>

    <!-- â”€â”€ Popup Settings Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="admin-tab" id="tab-popups">
      <div class="admin-card">
        <h3 class="admin-card-title">Subscribe Newsletter Popup</h3>
        <div class="toggle-row">
          <span class="toggle-label">Enable subscribe popup</span>
          <label class="toggle">
            <input type="checkbox" id="showSubscribePopup">
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="form-group" style="margin-top:16px">
          <label class="form-label">Auto-show delay after page load (milliseconds)</label>
          <input type="number" class="form-input" id="subscribeDelay" min="0" max="60000" step="500" placeholder="6000">
          <span class="form-hint">0 = show immediately. 6000 = show after 6 seconds.</span>
        </div>
      </div>
      <div class="admin-card">
        <h3 class="admin-card-title">Advertise With Us Popup</h3>
        <div class="toggle-row">
          <span class="toggle-label">Show advertise button in header</span>
          <label class="toggle">
            <input type="checkbox" id="showAdvertisePopup">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Menu Navigation Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="admin-tab" id="tab-menus">
      <div class="admin-card">
        <div class="admin-card-head">
          <h3 class="admin-card-title">Header Navigation Links</h3>
          <button class="admin-add-btn" onclick="addMenuItem()">+ Add Link</button>
        </div>
        <p class="admin-card-desc">Drag to reorder. Each label must exactly match a page in the /pages/ directory (or use "Feed" for the homepage).</p>
        <div id="menuList" class="sortable-list"></div>
      </div>
    </div>

    <!-- â”€â”€ General Settings Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="admin-tab" id="tab-general">
      <div class="admin-card">
        <h3 class="admin-card-title">Site Settings</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Site URL</label>
            <input type="url" class="form-input" id="siteUrl" placeholder="https://ghanafront.com">
          </div>
          <div class="form-group">
            <label class="form-label">Admin Email</label>
            <input type="email" class="form-input" id="adminEmail" placeholder="admin@ghanafront.com">
          </div>
        </div>
      </div>
      <div class="admin-card">
        <h3 class="admin-card-title">Admin Password</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Current Password</label>
            <input type="password" class="form-input" id="currentPassword" placeholder="Enter current password">
          </div>
          <div class="form-group">
            <label class="form-label">New Password</label>
            <input type="password" class="form-input" id="newPassword" placeholder="Min. 8 characters">
          </div>
          <div class="form-group">
            <label class="form-label">Confirm New Password</label>
            <input type="password" class="form-input" id="confirmPassword" placeholder="Repeat new password">
          </div>
        </div>
        <button class="admin-save-btn" onclick="changePassword()" style="margin-top:8px">Update Password</button>
        <div id="pwMsg" class="form-hint" style="margin-top:6px"></div>
      </div>
    </div>

    <!-- â”€â”€ Backend / API Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="admin-tab" id="tab-backend">
      <div class="admin-card">
        <h3 class="admin-card-title">API Configuration</h3>
        <p class="admin-card-desc">Your backend runs on Render and connects to Supabase. Set the API URL below to enable live status checks.</p>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Backend API Base URL</label>
            <input type="url" class="form-input" id="apiBase" placeholder="https://ghanaever-new.onrender.com">
            <span class="form-hint">e.g. https://ghanaever-new.onrender.com</span>
          </div>
        </div>
        <div style="display:flex;gap:12px;margin-top:16px;flex-wrap:wrap;align-items:center">
          <button class="admin-save-btn" onclick="testDbConnection()">
            <span id="dbTestText">Test API Connection</span>
          </button>
          <button class="admin-save-btn" style="background:var(--subtle-bg)" onclick="triggerScraper()">
            <span id="scraperBtnText">â–¶ Run Scraper Now</span>
          </button>
          <div id="dbTestResult" class="db-result"></div>
        </div>
      </div>
      <div class="admin-card">
        <h3 class="admin-card-title">System Status</h3>
        <p class="admin-card-desc" style="margin-bottom:16px">Click "Refresh Status" to check live system health.</p>
        <div class="status-grid">
          <div class="status-item">
            <div class="status-dot status-green"></div>
            <span>Frontend</span>
            <span class="status-val">Running</span>
          </div>
          <div class="status-item">
            <div class="status-dot" id="apiStatusDot" style="background:var(--subtle)"></div>
            <span>Backend API</span>
            <span class="status-val" id="apiStatusVal">Unknown</span>
          </div>
          <div class="status-item">
            <div class="status-dot" id="dbStatusDot" style="background:var(--subtle)"></div>
            <span>Database</span>
            <span class="status-val" id="dbStatusVal">Unknown</span>
          </div>
          <div class="status-item">
            <div class="status-dot" id="scraperStatusDot" style="background:var(--subtle)"></div>
            <span>Scraper (Last Run)</span>
            <span class="status-val" id="scraperStatusVal">Unknown</span>
          </div>
          <div class="status-item">
            <div class="status-dot" id="articlesStatusDot" style="background:var(--subtle)"></div>
            <span>Total Articles</span>
            <span class="status-val" id="articlesStatusVal">â€”</span>
          </div>
        </div>
        <button class="admin-save-btn" style="margin-top:16px" onclick="refreshStatus()">
          <span id="refreshBtnText">âŸ³ Refresh Status</span>
        </button>
        <div id="statusError" style="margin-top:10px;font-size:12px;color:#ef4444"></div>
      </div>
      <div class="admin-card">
        <h3 class="admin-card-title">Database Info</h3>
        <p class="admin-card-desc">Your database is managed by <strong>Supabase</strong> (PostgreSQL). No manual DB connection needed.</p>
        <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
          <a href="https://supabase.com/dashboard" target="_blank" class="admin-save-btn" style="text-decoration:none">Open Supabase Dashboard â†—</a>
          <a href="https://dashboard.render.com" target="_blank" class="admin-save-btn" style="text-decoration:none;background:var(--subtle-bg)">Open Render Dashboard â†—</a>
        </div>
      </div>
      <!-- Hidden legacy fields to avoid JS errors -->
      <input type="hidden" id="dbHost" value="supabase">
      <input type="hidden" id="dbPort" value="5432">
      <input type="hidden" id="dbName" value="postgres">
      <input type="hidden" id="dbUser" value="postgres">
    </div>

  </main>
</div>

<script>
  try {
    var cfg = JSON.parse(localStorage.getItem('gf_site_config') || '{}');
    window.API_BASE = cfg.apiBase || 'https://ghanaever-new.onrender.com';
  } catch(e) {
    window.API_BASE = 'https://ghanaever-new.onrender.com';
  }
</script>
<script src="../js/app.js"></script>
<script>
/* â”€â”€ Admin auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const ADMIN_DEFAULT_EMAIL = 'admin@ghanafront.com';
const ADMIN_DEFAULT_PASS  = 'admin123';

function getAdminCreds() {
  try {
    const c = localStorage.getItem('gf_admin_creds');
    return c ? JSON.parse(c) : { email: ADMIN_DEFAULT_EMAIL, password: ADMIN_DEFAULT_PASS };
  } catch { return { email: ADMIN_DEFAULT_EMAIL, password: ADMIN_DEFAULT_PASS }; }
}

/* â”€â”€â”€ API Base & Admin Secret â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getApiBase() {
  return localStorage.getItem('gf_api') || '';
}
function getAdminSecret() {
  return localStorage.getItem('gf_admin_secret') || 'ghanafront-admin-secret-change-me';
}
function adminHeaders() {
  return { 'Content-Type': 'application/json', 'x-admin-secret': getAdminSecret() };
}

/* â”€â”€â”€ Scraped Articles Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let scrapedPage = 1;
let selectedIds = new Set();

async function loadScrapedArticles(page = 1) {
  const list = document.getElementById('scrapedList');
  const countEl = document.getElementById('scrapedCount');
  if (!list) return;
  list.innerHTML = '<div style="padding:20px;text-align:center;color:var(--muted)">Loading...</div>';

  const base = getApiBase();
  if (!base) {
    list.innerHTML = '<div style="padding:20px;color:#dc2626">âš ï¸ Set your API URL in Backend/API settings first.</div>';
    return;
  }

  try {
    const r = await fetch(`${base}/api/admin/scraped?page=${page}&limit=30`, { headers: adminHeaders() });
    if (!r.ok) { list.innerHTML = `<div style="padding:20px;color:#dc2626">Error ${r.status}: ${await r.text()}</div>`; return; }
    const data = await r.json();
    const articles = data.articles || [];
    if (countEl) countEl.textContent = `${articles.length} articles pending`;
    document.getElementById('pendingBadge').textContent = articles.length || '';

    if (!articles.length) {
      list.innerHTML = '<div style="padding:20px;text-align:center;color:var(--muted)">No pending articles. Click "Scrape Now" to fetch fresh news.</div>';
      return;
    }

    list.innerHTML = articles.map(a => `
      <div class="admin-card" style="margin-bottom:0;padding:14px 16px" id="scraped-${a.id}">
        <div style="display:flex;gap:10px;align-items:flex-start">
          <input type="checkbox" class="scraped-check" data-id="${a.id}" style="margin-top:3px;flex-shrink:0"
            onchange="toggleScrapedSelect('${a.id}',this.checked)">
          ${a.image_url ? `<img src="${a.image_url}" style="width:70px;height:50px;object-fit:cover;border-radius:6px;flex-shrink:0" loading="lazy">` : ''}
          <div style="flex:1;min-width:0">
            <div style="font-weight:600;font-size:13px;line-height:1.35;margin-bottom:4px">${a.title}</div>
            <div style="font-size:11px;color:var(--muted);margin-bottom:8px">
              <span class="tag tag-${a.category}" style="font-size:10px">${a.category}</span>
              &nbsp;${a.source} Â· ${a.region} Â· ${a.published_at ? new Date(a.published_at).toLocaleDateString() : ''}
              ${a.content ? ` Â· ~${a.content.split(/\s+/).length} words` : ''}
            </div>
            <div style="font-size:12px;color:var(--muted);line-height:1.4;margin-bottom:10px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden">
              ${a.summary || ''}
            </div>
            <div style="display:flex;gap:6px;flex-wrap:wrap">
              <button onclick="approveOne('${a.id}', false)" class="admin-add-btn" style="font-size:11px;padding:4px 10px">âœ… Approve</button>
              <button onclick="approveOne('${a.id}', true)" class="admin-add-btn" style="background:#7c3aed;font-size:11px;padding:4px 10px">ğŸ¤– AI Rewrite + Approve</button>
              <button onclick="deleteOne('${a.id}')" class="admin-add-btn" style="background:#dc2626;font-size:11px;padding:4px 10px">ğŸ—‘</button>
              ${a.url ? `<a href="${a.url}" target="_blank" class="admin-add-btn" style="background:var(--surface2);color:var(--text);font-size:11px;padding:4px 10px;text-decoration:none">ğŸ”— Source</a>` : ''}
            </div>
          </div>
        </div>
      </div>`).join('');
  } catch(e) {
    list.innerHTML = `<div style="padding:20px;color:#dc2626">Error: ${e.message}</div>`;
  }
}

function toggleScrapedSelect(id, checked) {
  if (checked) selectedIds.add(id);
  else selectedIds.delete(id);
}

function toggleSelectAll(el) {
  document.querySelectorAll('.scraped-check').forEach(cb => {
    cb.checked = el.checked;
    toggleScrapedSelect(cb.dataset.id, el.checked);
  });
}

async function approveOne(id, aiRewrite) {
  const el = document.getElementById(`scraped-${id}`);
  if (el) el.style.opacity = '0.5';
  const base = getApiBase();
  try {
    const r = await fetch(`${base}/api/admin/approve`, {
      method: 'POST', headers: adminHeaders(),
      body: JSON.stringify({ article_id: id, ai_rewrite: aiRewrite, auto_publish: true })
    });
    if (r.ok) { if (el) el.remove(); }
    else alert('Error: ' + await r.text());
  } catch(e) { alert('Error: ' + e.message); if (el) el.style.opacity = '1'; }
}

async function deleteOne(id) {
  if (!confirm('Delete this article?')) return;
  const base = getApiBase();
  const el = document.getElementById(`scraped-${id}`);
  try {
    await fetch(`${base}/api/admin/articles/${id}`, { method: 'DELETE', headers: adminHeaders() });
    if (el) el.remove();
  } catch(e) { alert('Error: ' + e.message); }
}

async function bulkApprove(aiRewrite) {
  const ids = [...selectedIds];
  if (!ids.length) {
    // If nothing selected, use all visible
    document.querySelectorAll('.scraped-check').forEach(cb => ids.push(cb.dataset.id));
  }
  if (!ids.length) { alert('No articles selected.'); return; }
  if (!confirm(`${aiRewrite ? 'AI Rewrite + Approve' : 'Approve'} ${ids.length} articles?`)) return;

  const base = getApiBase();
  const statusEl = document.getElementById('scrapedCount');
  if (statusEl) statusEl.textContent = `Processing ${ids.length} articles...`;

  try {
    const r = await fetch(`${base}/api/admin/approve-bulk?ai_rewrite=${aiRewrite}`, {
      method: 'POST', headers: adminHeaders(),
      body: JSON.stringify(ids)
    });
    const res = await r.json();
    const ok = (res.results || []).filter(x => x.ok).length;
    alert(`Done! ${ok}/${ids.length} articles published.`);
    selectedIds.clear();
    loadScrapedArticles();
  } catch(e) { alert('Error: ' + e.message); }
}

async function deleteSelected() {
  const ids = [...selectedIds];
  if (!ids.length) { alert('Select articles first.'); return; }
  if (!confirm(`Delete ${ids.length} articles?`)) return;
  const base = getApiBase();
  for (const id of ids) {
    try { await fetch(`${base}/api/admin/articles/${id}`, { method: 'DELETE', headers: adminHeaders() }); }
    catch {}
    const el = document.getElementById(`scraped-${id}`);
    if (el) el.remove();
  }
  selectedIds.clear();
}

async function triggerScrape() {
  const btn = document.getElementById('scrapeNowBtn');
  if (btn) { btn.textContent = 'â³ Scraping...'; btn.disabled = true; }
  const base = getApiBase();
  try {
    const r = await fetch(`${base}/api/admin/scrape`, { method: 'POST', headers: adminHeaders() });
    const d = await r.json();
    if (d.error) alert('Scrape error: ' + d.error);
    else { alert('Scrape complete! Refreshing list...'); loadScrapedArticles(); }
  } catch(e) { alert('Error: ' + e.message); }
  finally { if (btn) { btn.textContent = 'ğŸ”„ Scrape Now'; btn.disabled = false; } }
}

/* â”€â”€â”€ Post Article Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener('DOMContentLoaded', () => {
  const content = document.getElementById('postContent');
  if (content) {
    content.addEventListener('input', () => {
      const words = content.value.trim().split(/\s+/).filter(Boolean).length;
      const el = document.getElementById('contentWordCount');
      if (el) el.textContent = `${words} words`;
    });
  }
});

async function submitPostArticle() {
  const title = document.getElementById('postTitle')?.value.trim();
  const content = document.getElementById('postContent')?.value.trim();
  if (!title || !content) { alert('Title and content are required.'); return; }

  const statusEl = document.getElementById('postStatus');
  if (statusEl) statusEl.innerHTML = '<span style="color:var(--muted)">â³ Publishing...</span>';

  const payload = {
    title,
    content,
    summary: document.getElementById('postSummary')?.value.trim() || '',
    category: document.getElementById('postCategory')?.value || 'general',
    region: document.getElementById('postRegion')?.value || 'ghana',
    source: document.getElementById('postSource')?.value.trim() || 'GhanaFront Staff',
    image_url: document.getElementById('postImageUrl')?.value.trim() || '',
    ai_expand: document.getElementById('postAiExpand')?.checked || false,
    auto_publish: document.getElementById('postAutoPublish')?.checked || true,
  };

  const base = getApiBase();
  try {
    const r = await fetch(`${base}/api/admin/post-article`, {
      method: 'POST', headers: adminHeaders(), body: JSON.stringify(payload)
    });
    if (!r.ok) throw new Error(await r.text());
    const d = await r.json();
    if (statusEl) statusEl.innerHTML = '<span style="color:#16a34a">âœ… Article published successfully!</span>';
    clearPostForm();
  } catch(e) {
    if (statusEl) statusEl.innerHTML = `<span style="color:#dc2626">âŒ Error: ${e.message}</span>`;
  }
}

function clearPostForm() {
  ['postTitle','postContent','postSummary','postImageUrl'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });
  const wc = document.getElementById('contentWordCount');
  if (wc) wc.textContent = '0 words';
  const s = document.getElementById('postSource');
  if (s) s.value = 'GhanaFront Staff';
}

/* â”€â”€â”€ Override switchTab to load scraped on tab switch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function loadTabData(id) {
  if (id === 'scraped') loadScrapedArticles();
}

function adminLogin(e) {
  e.preventDefault();
  const email = document.getElementById('loginEmail').value.trim();
  const pass  = document.getElementById('loginPassword').value;
  const creds = getAdminCreds();
  if (email === creds.email && pass === creds.password) {
    sessionStorage.setItem('gf_admin_auth', '1');
    document.getElementById('loginGate').style.display = 'none';
    document.getElementById('adminPanel').style.display = 'flex';
    initAdmin();
  } else {
    document.getElementById('loginError').style.display = 'block';
  }
}

function adminLogout() {
  sessionStorage.removeItem('gf_admin_auth');
  location.reload();
}

function changePassword() {
  const current = document.getElementById('currentPassword').value;
  const newPw   = document.getElementById('newPassword').value;
  const confirm = document.getElementById('confirmPassword').value;
  const msg     = document.getElementById('pwMsg');
  const creds   = getAdminCreds();
  if (current !== creds.password) { msg.textContent = 'âœ— Current password is incorrect'; msg.style.color = '#ef4444'; return; }
  if (newPw.length < 8) { msg.textContent = 'âœ— New password must be at least 8 characters'; msg.style.color = '#ef4444'; return; }
  if (newPw !== confirm) { msg.textContent = 'âœ— Passwords do not match'; msg.style.color = '#ef4444'; return; }
  localStorage.setItem('gf_admin_creds', JSON.stringify({ email: creds.email, password: newPw }));
  msg.textContent = 'âœ“ Password updated successfully'; msg.style.color = '#22c55e';
  document.getElementById('currentPassword').value = '';
  document.getElementById('newPassword').value = '';
  document.getElementById('confirmPassword').value = '';
}

/* â”€â”€ Tab switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const TAB_TITLES = {
  scraped: 'ğŸ“° Scraped Articles', post: 'âœï¸ Post Article',
  scraper: 'Scraper Config', ticker: 'Ticker Settings', breaking: 'Breaking News',
  trending: 'Trending News', appearance: 'Appearance & Branding', popups: 'Popup Settings',
  menus: 'Menu Navigation', general: 'General Settings', backend: 'Backend / API',
};
function switchTab(id, btn) {
  document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.admin-nav-item').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + id)?.classList.add('active');
  btn.classList.add('active');
  document.getElementById('adminPageTitle').textContent = TAB_TITLES[id] || id;
  loadTabData(id);
}

/* â”€â”€ Init admin â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initAdmin() {
  applyDark();
  injectAdminIcons();
  loadFormValues();
  renderRssList();
  loadScrapedArticles(); // load scraped on init
  renderBreakingList();
  renderTrendingList();
  renderMenuList();
  renderTickerPreview();
}

function injectAdminIcons() {
  document.getElementById('iconRss').innerHTML        = ICONS.rss;
  document.getElementById('iconTicker').innerHTML     = ICONS.megaphone;
  document.getElementById('iconBreaking').innerHTML   = ICONS.trending;
  document.getElementById('iconTrending').innerHTML   = ICONS.trending;
  document.getElementById('iconAppearance').innerHTML = ICONS.palette;
  document.getElementById('iconPopups').innerHTML     = ICONS.popup;
  document.getElementById('iconMenus').innerHTML      = ICONS.nav;
  document.getElementById('iconGeneral').innerHTML    = ICONS.gear;
  document.getElementById('iconBackend').innerHTML    = ICONS.database;
}

/* â”€â”€ Load / Save â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function loadFormValues() {
  const cfg = getSiteConfig();
  document.getElementById('adminSiteName').textContent = cfg.siteName || 'GhanaFront';
  // Appearance
  document.getElementById('siteName').value          = cfg.siteName || '';
  document.getElementById('siteTagline').value       = cfg.siteTagline || '';
  document.getElementById('logoUrl').value           = cfg.logoUrl || '';
  document.getElementById('faviconUrl').value        = cfg.faviconUrl || '';
  document.getElementById('primaryColor').value      = cfg.primaryColor || '#ce1126';
  document.getElementById('primaryColorHex').value   = cfg.primaryColor || '#ce1126';
  document.getElementById('accentColor').value       = cfg.accentColor || '#d4993a';
  document.getElementById('accentColorHex').value    = cfg.accentColor || '#d4993a';
  document.getElementById('searchPlaceholder').value = cfg.searchPlaceholder || '';
  updateColorPreview();
  // Ticker
  document.getElementById('tickerLabel').value       = cfg.tickerLabel || 'Breaking';
  document.getElementById('tickerSpeed').value       = cfg.tickerSpeed || 18;
  // Scraper
  document.getElementById('scrapeInterval').value    = cfg.scrapeInterval || 5;
  document.getElementById('maxArticles').value       = cfg.maxArticles || 20;
  document.getElementById('retention').value         = cfg.retention || 30;
  // Popups
  document.getElementById('showSubscribePopup').checked  = cfg.showSubscribePopup !== false;
  document.getElementById('showAdvertisePopup').checked  = cfg.showAdvertisePopup !== false;
  document.getElementById('subscribeDelay').value         = cfg.subscribeDelay || 6000;
  // General
  document.getElementById('siteUrl').value           = cfg.siteUrl || '';
  document.getElementById('adminEmail').value        = cfg.adminEmail || '';
  // Backend
  document.getElementById('dbHost').value            = cfg.dbHost || 'localhost';
  document.getElementById('dbPort').value            = cfg.dbPort || '5432';
  document.getElementById('dbName').value            = cfg.dbName || 'ghanafront';
  document.getElementById('dbUser').value            = cfg.dbUser || 'admin';
  document.getElementById('apiBase').value           = cfg.apiBase || '';
  // Color pickers sync
  document.getElementById('primaryColor').addEventListener('input', e => {
    document.getElementById('primaryColorHex').value = e.target.value;
    updateColorPreview();
  });
  document.getElementById('accentColor').addEventListener('input', e => {
    document.getElementById('accentColorHex').value = e.target.value;
    updateColorPreview();
  });
  document.getElementById('primaryColorHex').addEventListener('input', e => {
    if (/^#[0-9a-f]{6}$/i.test(e.target.value)) {
      document.getElementById('primaryColor').value = e.target.value;
      updateColorPreview();
    }
  });
  document.getElementById('accentColorHex').addEventListener('input', e => {
    if (/^#[0-9a-f]{6}$/i.test(e.target.value)) {
      document.getElementById('accentColor').value = e.target.value;
      updateColorPreview();
    }
  });
  // Ticker speed preview on change
  document.getElementById('tickerSpeed').addEventListener('input', renderTickerPreview);
  document.getElementById('tickerLabel').addEventListener('input', renderTickerPreview);
}

function updateColorPreview() {
  const c1 = document.getElementById('primaryColor').value;
  const c2 = document.getElementById('accentColor').value;
  document.getElementById('swatch1').style.background = c1;
  document.getElementById('swatch2').style.background = c2;
}

function collectFormValues() {
  const cfg = getSiteConfig();
  // Appearance
  cfg.siteName          = document.getElementById('siteName').value.trim() || 'GhanaFront';
  cfg.siteTagline       = document.getElementById('siteTagline').value.trim();
  cfg.logoUrl           = document.getElementById('logoUrl').value.trim();
  cfg.faviconUrl        = document.getElementById('faviconUrl').value.trim();
  cfg.primaryColor      = document.getElementById('primaryColorHex').value.trim() || '#ce1126';
  cfg.accentColor       = document.getElementById('accentColorHex').value.trim() || '#d4993a';
  cfg.searchPlaceholder = document.getElementById('searchPlaceholder').value.trim();
  // Ticker
  cfg.tickerLabel       = document.getElementById('tickerLabel').value.trim() || 'Breaking';
  cfg.tickerSpeed       = parseInt(document.getElementById('tickerSpeed').value) || 18;
  // Scraper
  cfg.scrapeInterval    = parseInt(document.getElementById('scrapeInterval').value) || 5;
  cfg.maxArticles       = parseInt(document.getElementById('maxArticles').value) || 20;
  cfg.retention         = parseInt(document.getElementById('retention').value) || 30;
  cfg.defaultCategory   = document.getElementById('defaultCategory').value;
  // Popups
  cfg.showSubscribePopup = document.getElementById('showSubscribePopup').checked;
  cfg.showAdvertisePopup = document.getElementById('showAdvertisePopup').checked;
  cfg.subscribeDelay     = parseInt(document.getElementById('subscribeDelay').value) || 6000;
  // General
  cfg.siteUrl   = document.getElementById('siteUrl').value.trim();
  cfg.adminEmail = document.getElementById('adminEmail').value.trim();
  // Backend
  cfg.dbHost   = document.getElementById('dbHost').value.trim();
  cfg.dbPort   = document.getElementById('dbPort').value.trim();
  cfg.dbName   = document.getElementById('dbName').value.trim();
  cfg.dbUser   = document.getElementById('dbUser').value.trim();
  cfg.apiBase  = document.getElementById('apiBase').value.trim();
  // Lists from DOM
  cfg.rssSources   = collectRssList();
  cfg.breakingNews = collectTextList('breakingList');
  cfg.trendingNews = collectTextList('trendingList');
  cfg.menuLinks    = collectTextList('menuList');
  return cfg;
}

function saveAllSettings() {
  const btn = document.getElementById('saveBtn');
  const txt = document.getElementById('saveBtnText');
  const status = document.getElementById('saveStatus');
  txt.textContent = 'Savingâ€¦';
  btn.disabled = true;
  setTimeout(() => {
    const cfg = collectFormValues();
    saveSiteConfig(cfg);
    document.getElementById('adminSiteName').textContent = cfg.siteName;
    renderTickerPreview();
    txt.textContent = 'Save Changes';
    btn.disabled = false;
    status.textContent = 'âœ“ Saved';
    status.className = 'save-status saved';
    setTimeout(() => { status.textContent = ''; status.className = 'save-status'; }, 3000);
  }, 600);
}

/* â”€â”€ RSS List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderRssList() {
  const cfg = getSiteConfig();
  const sources = cfg.rssSources || [];
  document.getElementById('rssList').innerHTML = sources.map((s, i) => `
    <div class="rss-item" data-idx="${i}">
      <label class="toggle" style="flex-shrink:0">
        <input type="checkbox" ${s.active ? 'checked' : ''} onchange="toggleRss(${i})">
        <span class="toggle-slider"></span>
      </label>
      <input class="form-input rss-name-input" value="${s.name}" placeholder="Source Name" onchange="updateRss(${i},'name',this.value)">
      <input class="form-input rss-url-input" value="${s.url}" placeholder="https://example.com/feed" onchange="updateRss(${i},'url',this.value)">
      <button class="rss-remove" onclick="removeRss(${i})" title="Remove">${ICONS.trash}</button>
    </div>`).join('');
}

let _rssSources = null;
function getRssSources() {
  if (_rssSources === null) _rssSources = [...(getSiteConfig().rssSources || [])];
  return _rssSources;
}
function addRssSource() {
  const sources = getRssSources();
  sources.push({ name: 'New Source', url: '', active: true });
  _rssSources = sources;
  renderRssFromMemory();
}
function removeRss(i) {
  const s = getRssSources(); s.splice(i, 1); renderRssFromMemory();
}
function toggleRss(i) {
  const s = getRssSources(); s[i].active = !s[i].active;
}
function updateRss(i, field, val) {
  const s = getRssSources(); s[i][field] = val;
}
function renderRssFromMemory() {
  const sources = getRssSources();
  document.getElementById('rssList').innerHTML = sources.map((s, i) => `
    <div class="rss-item" data-idx="${i}">
      <label class="toggle" style="flex-shrink:0">
        <input type="checkbox" ${s.active ? 'checked' : ''} onchange="toggleRss(${i})">
        <span class="toggle-slider"></span>
      </label>
      <input class="form-input rss-name-input" value="${s.name}" placeholder="Source Name" onchange="updateRss(${i},'name',this.value)">
      <input class="form-input rss-url-input" value="${s.url}" placeholder="https://example.com/feed" onchange="updateRss(${i},'url',this.value)">
      <button class="rss-remove" onclick="removeRss(${i})" title="Remove">${ICONS.trash}</button>
    </div>`).join('');
}
function collectRssList() {
  if (_rssSources !== null) return _rssSources;
  return (getSiteConfig().rssSources || []);
}

/* â”€â”€ Generic sortable text lists â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderTextList(containerId, items, addFn) {
  const container = document.getElementById(containerId);
  container.innerHTML = items.map((item, i) => `
    <div class="sortable-item" data-idx="${i}">
      <span class="drag-handle">â ¿</span>
      <input class="form-input" value="${item}" placeholder="Enter textâ€¦" onchange="updateListItem('${containerId}',${i},this.value)">
      <button class="rss-remove" onclick="removeListItem('${containerId}',${i})" title="Remove">${ICONS.trash}</button>
    </div>`).join('');
}

const _listData = {};
function getListData(id) {
  if (!_listData[id]) {
    const cfg = getSiteConfig();
    if (id === 'breakingList') _listData[id] = [...(cfg.breakingNews || [])];
    else if (id === 'trendingList') _listData[id] = [...(cfg.trendingNews || [])];
    else if (id === 'menuList') _listData[id] = [...(cfg.menuLinks || [])];
  }
  return _listData[id];
}
function renderBreakingList()  { renderTextList('breakingList', getListData('breakingList')); }
function renderTrendingList()  { renderTextList('trendingList', getListData('trendingList')); }
function renderMenuList()      { renderTextList('menuList', getListData('menuList')); }

function addBreakingItem() { getListData('breakingList').push('New headline'); renderBreakingList(); }
function addTrendingItem() { getListData('trendingList').push('New trending story'); renderTrendingList(); }
function addMenuItem()     { getListData('menuList').push('PageName'); renderMenuList(); }

function updateListItem(id, i, val) { getListData(id)[i] = val; }
function removeListItem(id, i) {
  getListData(id).splice(i, 1);
  if (id === 'breakingList') renderBreakingList();
  else if (id === 'trendingList') renderTrendingList();
  else if (id === 'menuList') renderMenuList();
}
function collectTextList(id) {
  if (_listData[id]) return _listData[id];
  const items = [];
  document.querySelectorAll(`#${id} .sortable-item input`).forEach(inp => items.push(inp.value));
  return items;
}

/* â”€â”€ Ticker preview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderTickerPreview() {
  const label = document.getElementById('tickerLabel')?.value || 'Breaking';
  const speed = document.getElementById('tickerSpeed')?.value || 18;
  const items = getListData('breakingList');
  const doubled = [...items, ...items];
  document.getElementById('tickerPreview').innerHTML = `
    <div class="ticker">
      <div class="ticker-tag"><div class="ticker-blink"></div>${label}</div>
      <div class="ticker-track">
        <div class="ticker-reel" style="animation-duration:${speed}s">
          ${doubled.map(t => `<a class="ticker-item" href="#"><div class="ticker-sep"></div>${t}</a>`).join('')}
        </div>
      </div>
    </div>`;
}

/* â”€â”€ API helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getApiBase() {
  const saved = getSiteConfig().apiBase || document.getElementById('apiBase').value.trim();
  return (saved || 'https://ghanaever-new.onrender.com').replace(/\/$/, '');
}

async function testDbConnection() {
  const btn = document.getElementById('dbTestText');
  const result = document.getElementById('dbTestResult');
  btn.textContent = 'Testingâ€¦';
  result.textContent = '';
  result.className = 'db-result';
  const base = getApiBase();
  try {
    const res = await fetch(base + '/health', { signal: AbortSignal.timeout(8000) });
    const data = await res.json();
    btn.textContent = 'Test API Connection';
    if (res.ok) {
      result.textContent = 'âœ“ Connected â€” API is live (' + (data.timestamp || 'ok') + ')';
      result.className = 'db-result db-ok';
    } else {
      result.textContent = 'âœ— API returned an error';
      result.className = 'db-result db-error';
    }
  } catch(e) {
    btn.textContent = 'Test API Connection';
    result.textContent = 'âœ— Could not reach API: ' + e.message;
    result.className = 'db-result db-error';
  }
}

async function refreshStatus() {
  const btn = document.getElementById('refreshBtnText');
  const errEl = document.getElementById('statusError');
  btn.textContent = 'âŸ³ Checkingâ€¦';
  errEl.textContent = '';
  const base = getApiBase();

  function setDot(dotId, valId, ok, label) {
    document.getElementById(dotId).style.background = ok ? '#22c55e' : '#ef4444';
    document.getElementById(valId).textContent = label;
  }

  try {
    const res = await fetch(base + '/health', { signal: AbortSignal.timeout(8000) });
    setDot('apiStatusDot', 'apiStatusVal', res.ok, res.ok ? 'Online' : 'Error');
  } catch { setDot('apiStatusDot', 'apiStatusVal', false, 'Offline'); }

  try {
    const res = await fetch(base + '/api/status', { signal: AbortSignal.timeout(8000) });
    if (res.ok) {
      const data = await res.json();
      setDot('dbStatusDot', 'dbStatusVal', true, 'Connected');
      document.getElementById('articlesStatusDot').style.background = '#22c55e';
      document.getElementById('articlesStatusVal').textContent = (data.article_count ?? 'â€”') + ' articles';
      if (data.last_scrape) {
        const ago = Math.round((Date.now() - new Date(data.last_scrape)) / 60000);
        setDot('scraperStatusDot', 'scraperStatusVal', true, ago + 'm ago');
      } else {
        setDot('scraperStatusDot', 'scraperStatusVal', false, 'No data yet');
      }
    } else { setDot('dbStatusDot', 'dbStatusVal', false, 'Error'); }
  } catch { setDot('dbStatusDot', 'dbStatusVal', false, 'Unreachable'); }

  btn.textContent = 'âŸ³ Refresh Status';
}

async function triggerScraper() {
  const btn = document.getElementById('scraperBtnText');
  const base = getApiBase();
  if (!base) { alert('Set the Backend API Base URL first.'); return; }
  btn.textContent = 'â³ Runningâ€¦';
  try {
    const res = await fetch(base + '/api/scrape', { method: 'POST', signal: AbortSignal.timeout(30000) });
    const data = await res.json();
    btn.textContent = 'â–¶ Run Scraper Now';
    alert('Scraper done! ' + (data.new_articles ?? 0) + ' new articles added.');
    refreshStatus();
  } catch(e) {
    btn.textContent = 'â–¶ Run Scraper Now';
    alert('Scraper error: ' + e.message);
  }
}

/* â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
if (sessionStorage.getItem('gf_admin_auth') === '1') {
  document.getElementById('loginGate').style.display = 'none';
  document.getElementById('adminPanel').style.display = 'flex';
  document.addEventListener('DOMContentLoaded', initAdmin);
} else {
  document.addEventListener('DOMContentLoaded', applyDark);
}
</script>
</body>
</html>